<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„ â€” Ø¹ÙŠÙ†Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>

  <!-- ===== CSS (Ù…Ø¶Ù…Ù‘Ù†) ===== -->
  <style>
    :root{
      --bg:#0b1020;
      --card:#121932;
      --muted:#8aa0c3;
      --text:#eef3ff;
      --primary:#4f7cff;
      --primary-600:#3d63d9;
      --danger:#ff5d5d;
      --success:#2ecc71;
      --border:#223056;
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .container{max-width:1100px;margin:auto;padding:16px}
    header{padding-top:24px}
    h1{margin:0 0 6px 0;font-size:26px}
    .subtitle{margin:0;color:var(--muted);font-size:14px}

    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:960px){.grid{grid-template-columns: 1fr 1fr}}

    .card{
      background:linear-gradient(180deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02));
      border:1px solid var(--border);
      border-radius:16px;
      padding:16px;
      box-shadow:0 8px 30px rgba(0,0,0,0.25);
    }
    .card h2{margin:0 0 12px 0}

    .grid-2{display:grid;grid-template-columns:1fr;gap:12px}
    .grid-3{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){
      .grid-2{grid-template-columns:1fr 1fr}
      .grid-3{grid-template-columns:repeat(3,1fr)}
    }

    .field label{display:block;margin-bottom:6px;color:var(--muted);font-size:13px}
    .field label span{color:#ffb34f}
    .field input{
      width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);
      background:#0d1530;color:var(--text);outline:none
    }
    .field input::placeholder{color:#6e84a8}

    .actions{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
    .btn{
      padding:10px 14px;border-radius:12px;border:1px solid var(--border);
      background:#182246;color:var(--text);cursor:pointer
    }
    .btn:hover{filter:brightness(1.08)}
    .btn.primary{background:var(--primary);border-color:transparent}
    .btn.primary:hover{background:var(--primary-600)}
    .btn.ghost{background:transparent}
    .btn.danger{background:var(--danger);border-color:transparent}

    .table-head{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .search{
      padding:10px 12px;border-radius:12px;border:1px solid var(--border);
      background:#0d1530;color:var(--text);min-width:200px
    }

    .table-wrap{overflow:auto;border:1px solid var(--border);border-radius:12px}
    table{width:100%;border-collapse:collapse;font-size:14px;min-width:900px}
    th,td{padding:10px 8px;border-bottom:1px solid var(--border);text-align:center}
    th{position:sticky;top:0;background:#122046;z-index:1}
    tr:hover td{background:#0f1a38}

    .badge{
      display:inline-block;padding:4px 8px;border-radius:8px;font-size:12px
    }
    .badge.success{background:rgba(46,204,113,.15);color:var(--success);border:1px solid rgba(46,204,113,.35)}
    .badge.muted{background:rgba(255,255,255,.06);color:var(--muted);border:1px solid var(--border)}

    .footer{opacity:.7;text-align:center;margin:24px 0}
    .hint{color:var(--muted);margin-top:10px}
  </style>
</head>
<body>
  <header class="container">
    <h1>Ù„ÙˆØ­Ø© ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„ (Ø¹ÙŠÙ†Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„)</h1>
    <p class="subtitle">Ø¥Ø¯Ø®Ø§Ù„ ØªÙˆØµÙŠØ© âœ Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ âœ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªÙ†ÙÙŠØ° âœ ØªØµØ¯ÙŠØ± CSV</p>
  </header>

  <main class="container grid">
    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙˆØµÙŠØ© -->
    <section class="card">
      <h2>Ø¥Ø¯Ø®Ø§Ù„ ØªÙˆØµÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
      <form id="signalForm">
        <div class="grid-2">
          <div class="field">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø© <span>*</span></label>
            <input type="text" name="currency" placeholder="Ù…Ø«Ø§Ù„: BTCUSDT" required />
          </div>
          <div class="field">
            <label>Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ <span>*</span></label>
            <input type="text" name="entry" placeholder="Ù…Ø«Ø§Ù„: 25000 - 25200" required />
          </div>
        </div>

        <div class="grid-3">
          <div class="field">
            <label>Ø§Ù„Ù‡Ø¯Ù 1</label>
            <input type="text" name="target1" placeholder="Ù…Ø«Ø§Ù„: 26000" />
          </div>
          <div class="field">
            <label>Ø§Ù„Ù‡Ø¯Ù 2</label>
            <input type="text" name="target2" placeholder="Ù…Ø«Ø§Ù„: 26500" />
          </div>
          <div class="field">
            <label>Ø§Ù„Ù‡Ø¯Ù 3</label>
            <input type="text" name="target3" placeholder="Ù…Ø«Ø§Ù„: 27000" />
          </div>
          <div class="field">
            <label>Ø§Ù„Ù‡Ø¯Ù 4</label>
            <input type="text" name="target4" placeholder="Ù…Ø«Ø§Ù„: 27500" />
          </div>
          <div class="field">
            <label>Ø§Ù„Ù‡Ø¯Ù 5</label>
            <input type="text" name="target5" placeholder="Ù…Ø«Ø§Ù„: 28000" />
          </div>
          <div class="field">
            <label>ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø©</label>
            <input type="text" name="stopLoss" placeholder="Ù…Ø«Ø§Ù„: 24500" />
          </div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label>Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</label>
            <input type="text" name="personalInfo" placeholder="Ø§Ø³Ù…Ùƒ/Ø¬Ù‡ØªÙƒ" />
          </div>
          <div class="field">
            <label>Ø§Ø³Ù… Ø£Ùˆ Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù‚Ù†Ø§Ø©</label>
            <input type="text" name="channelName" placeholder="@channel Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©" />
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" type="submit">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆØµÙŠØ©</button>
          <button class="btn ghost" type="reset">ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
        </div>
      </form>
    </section>

    <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
    <section class="card">
      <div class="table-head">
        <h2>Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</h2>
        <div class="toolbar">
          <input id="searchInput" class="search" type="search" placeholder="Ø¨Ø­Ø«..." />
          <button id="exportCsvBtn" class="btn">ØªØµØ¯ÙŠØ± CSV</button>
          <button id="clearAllBtn" class="btn danger">Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
        </div>
      </div>

      <div class="table-wrap">
        <table id="signalsTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ù„Ø¹Ù…Ù„Ø©</th>
              <th>Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
              <th>Ù‡Ø¯Ù1</th>
              <th>Ù‡Ø¯Ù2</th>
              <th>Ù‡Ø¯Ù3</th>
              <th>Ù‡Ø¯Ù4</th>
              <th>Ù‡Ø¯Ù5</th>
              <th>ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø©</th>
              <th>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø®ØµÙŠØ©</th>
              <th>Ø§Ù„Ù‚Ù†Ø§Ø©</th>
              <th>ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©</th>
              <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody><!-- ÙŠÙ…ØªÙ„Ø¦ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ --></tbody>
        </table>
      </div>
      <p class="hint">ğŸ’¾ Ø§Ù„ØªÙˆØµÙŠØ§Øª ØªÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ø­Ù„ÙŠÙ‹Ø§ (LocalStorage) Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.</p>
    </section>
  </main>

  <footer class="container footer">
    <small>Ù‡Ø°Ù‡ Ø¹ÙŠÙ†Ø© ÙˆØ§Ø¬Ù‡Ø© Ù„Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ù‚Ø¯Ø±Ø© â€” Ù„Ø§ ØªÙ†ÙÙ‘Ø° ØµÙÙ‚Ø§Øª ÙØ¹Ù„ÙŠØ©. Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Binance/Telegram ÙŠØªÙ… Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø®ØµÙˆØµÙŠØ©.</small>
  </footer>

  <!-- ===== JavaScript (Ù…Ø¶Ù…Ù‘Ù†) ===== -->
  <script>
    // ====== ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ ======
    const STORAGE_KEY = "signals-v1";

    function loadSignals() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        console.warn("LocalStorage read error", e);
        return [];
      }
    }
    function saveSignals(list) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    }
    function nowStamp() {
      const d = new Date();
      const pad = n => String(n).padStart(2, "0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }

    let signals = loadSignals();

    // Ø¹Ù†Ø§ØµØ± DOM
    const form = document.getElementById("signalForm");
    const tableBody = document.querySelector("#signalsTable tbody");
    const exportBtn = document.getElementById("exportCsvBtn");
    const clearAllBtn = document.getElementById("clearAllBtn");
    const searchInput = document.getElementById("searchInput");

    // Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
    function renderTable(list = signals) {
      tableBody.innerHTML = "";
      list.forEach((s, idx) => {
        const tr = document.createElement("tr");

        const actions = `
          <div class="row-actions" style="display:flex;gap:6px;justify-content:center">
            <button class="btn" data-action="simulate" data-id="${s.id}">Simulate</button>
            <button class="btn" data-action="edit" data-id="${s.id}">ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="btn danger" data-action="delete" data-id="${s.id}">Ø­Ø°Ù</button>
          </div>
        `;
        const simBadge = s.simulatedAt ? `<span class="badge success">ØªÙ…Øª ${s.simulatedAt}</span>` : `<span class="badge muted">-</span>`;

        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td>${s.currency || ""}</td>
          <td>${s.entry || ""}</td>
          <td>${s.target1 || ""}</td>
          <td>${s.target2 || ""}</td>
          <td>${s.target3 || ""}</td>
          <td>${s.target4 || ""}</td>
          <td>${s.target5 || ""}</td>
          <td>${s.stopLoss || ""}</td>
          <td>${s.personalInfo || ""}</td>
          <td>${s.channelName || ""}</td>
          <td>${simBadge}</td>
          <td>${actions}</td>
        `;
        tableBody.appendChild(tr);
      });
    }

    // Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ ØªÙˆØµÙŠØ©
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const fd = new FormData(form);

      const record = {
        id: form.dataset.editId ? Number(form.dataset.editId) : Date.now(),
        currency: fd.get("currency")?.trim(),
        entry: fd.get("entry")?.trim(),
        target1: fd.get("target1")?.trim(),
        target2: fd.get("target2")?.trim(),
        target3: fd.get("target3")?.trim(),
        target4: fd.get("target4")?.trim(),
        target5: fd.get("target5")?.trim(),
        stopLoss: fd.get("stopLoss")?.trim(),
        personalInfo: fd.get("personalInfo")?.trim(),
        channelName: fd.get("channelName")?.trim(),
        simulatedAt: form.dataset.editId ? (signals.find(x=>x.id===Number(form.dataset.editId))?.simulatedAt || null) : null
      };

      if (!record.currency || !record.entry) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø© ÙˆÙ…Ø¬Ø§Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„.");
        return;
      }

      if (form.dataset.editId) {
        // ØªØ¹Ø¯ÙŠÙ„
        signals = signals.map(s => s.id === record.id ? record : s);
        delete form.dataset.editId;
      } else {
        // Ø¥Ø¶Ø§ÙØ©
        signals.unshift(record);
      }

      saveSignals(signals);
      form.reset();
      renderTable();
      window.scrollTo({top: document.body.scrollHeight, behavior:"smooth"});
    });

    // Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØµÙ (Ù…Ø­Ø§ÙƒØ§Ø©/ØªØ¹Ø¯ÙŠÙ„/Ø­Ø°Ù)
    tableBody.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      const id = Number(btn.dataset.id);
      const action = btn.dataset.action;
      const idx = signals.findIndex(s => s.id === id);
      if (idx < 0) return;

      if (action === "simulate") {
        signals[idx].simulatedAt = nowStamp();
        saveSignals(signals);
        renderTable();
        alert(`ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„ØµÙÙ‚Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¹Ù„Ù‰ ${signals[idx].currency} ÙÙŠ ${signals[idx].simulatedAt}`);
      }

      if (action === "edit") {
        const s = signals[idx];
        form.currency.value = s.currency || "";
        form.entry.value = s.entry || "";
        form.target1.value = s.target1 || "";
        form.target2.value = s.target2 || "";
        form.target3.value = s.target3 || "";
        form.target4.value = s.target4 || "";
        form.target5.value = s.target5 || "";
        form.stopLoss.value = s.stopLoss || "";
        form.personalInfo.value = s.personalInfo || "";
        form.channelName.value = s.channelName || "";
        form.dataset.editId = String(s.id);
        window.scrollTo({top:0,behavior:"smooth"});
      }

      if (action === "delete") {
        if (confirm("ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØªÙˆØµÙŠØ©ØŸ")) {
          signals.splice(idx, 1);
          saveSignals(signals);
          renderTable();
        }
      }
    });

    // Ø§Ù„Ø¨Ø­Ø«
    searchInput.addEventListener("input", () => {
      const q = searchInput.value.trim().toLowerCase();
      if (!q) return renderTable();
      const filtered = signals.filter(s =>
        Object.values(s).some(v => (v ?? "").toString().toLowerCase().includes(q))
      );
      renderTable(filtered);
    });

    // ØªØµØ¯ÙŠØ± CSV
    exportBtn.addEventListener("click", () => {
      if (!signals.length) {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§.");
        return;
      }
      const headers = ["Ø§Ù„Ø¹Ù…Ù„Ø©","Ù…Ø¬Ø§Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„","Ø§Ù„Ù‡Ø¯Ù1","Ø§Ù„Ù‡Ø¯Ù2","Ø§Ù„Ù‡Ø¯Ù3","Ø§Ù„Ù‡Ø¯Ù4","Ø§Ù„Ù‡Ø¯Ù5","ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø©","Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø®ØµÙŠØ©","Ø§Ù„Ù‚Ù†Ø§Ø©","ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©"];
      const rows = signals.map(s => [
        s.currency ?? "", s.entry ?? "", s.target1 ?? "", s.target2 ?? "", s.target3 ?? "",
        s.target4 ?? "", s.target5 ?? "", s.stopLoss ?? "", s.personalInfo ?? "", s.channelName ?? "",
        s.simulatedAt ?? ""
      ]);

      const csv = [headers, ...rows].map(r =>
        r.map(val => `"${String(val).replaceAll('"','""')}"`).join(",")
      ).join("\n");

      const blob = new Blob([csv], {type: "text/csv;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `signals_${Date.now()}.csv`;
      document.body.appendChild(a);
      a.click();
      URL.revokeObjectURL(url);
      a.remove();
    });

    // Ø­Ø°Ù Ø§Ù„ÙƒÙ„
    clearAllBtn.addEventListener("click", () => {
      if (!signals.length) return;
      if (confirm("ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØµÙŠØ§ØªØŸ")) {
        signals = [];
        saveSignals(signals);
        renderTable();
      }
    });

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
    renderTable();
  </script>
</body>
</html>